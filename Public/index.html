<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zomb.io</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="startScreen">
        <h1>Zomb.io</h1>
        <input type="text" id="playerName" placeholder="Enter your name">
        <button id="startGameBtn">Start Game</button>
        <div class="lobby-btn-container"></div>
            <!-- Adjust create lobby button when lobby is created -->
            <button id="createLobbyBtn">Create Lobby</button>
            <button id="joinLobbyBtn">Join Lobby</button>
        </div>
    </div>

    <div id="joinWindow" class="joinWindow">
        <div class="window-content">
            <span class="close">&times;</span>
            <h2>Join Lobby</h2>
            <input type="text" id="lobbyCode" placeholder="Enter Lobby Code">
            <button id="submit">Submit</button>
        </div>
    </div>

    <!-- Profile button to open the login modal -->
    <button id="profileButton">Profile</button>

    <!-- Modal overlay with login form -->
    <div id="modalOverlay">
        <div id="modalContent">
            <h2>Game Login</h2>
            <input type="email" id="email" placeholder="Email" />
            <input type="password" id="password" placeholder="Password (At least 6 characters)" />
            <button onclick="signIn(document.getElementById('email').value, document.getElementById('password').value)">
                Sign In
            </button>
            <button onclick="signUp(document.getElementById('email').value, document.getElementById('password').value)">
                Sign Up
            </button>
            <div id="errorMessage"></div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <!-- Include Firebase SDKs, client.js script -->
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-auth.js"></script>
    <script type="module" src="client.js"></script>

    <!-- Include Socket.IO client -->
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>

    <script src="joinWindow.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Silkscreen&v1" rel="stylesheet">

    <!-- Firebase Config and Authentication-->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-auth.js";
      
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDuW-eU3p0M8Rml-BbfOvBKMiskcnr9As8",
            authDomain: "zombio-93071.firebaseapp.com",
            projectId: "zombio-93071",
            storageBucket: "zombio-93071.firebasestorage.app",
            messagingSenderId: "151511197577",
            appId: "1:151511197577:web:e055612f78846897bba358"
        };
      
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
      
        // Sign-Up function
        async function signUp(email, password) {
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                console.log("User signed up:", userCredential.user);
                // Hide modal and show the start screen
                document.getElementById('modalOverlay').style.display = 'none';
                document.getElementById('startScreen').style.display = 'flex';
                // Optionally clear input fields
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
            } catch (error) {
                console.error("Error signing up:", error);
                document.getElementById('errorMessage').textContent = `Invalid Email and/or Password`;
            }
        }

        // Sign-in function
        async function signIn(email, password) {
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log("User signed in:", userCredential.user);
                // Hide modal and show the start screen
                document.getElementById('modalOverlay').style.display = 'none';
                document.getElementById('startScreen').style.display = 'flex';
                // Optionally clear input fields
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
            } catch (error) {
                console.error("Error signing in:", error);
                document.getElementById('errorMessage').textContent = `Invalid Email and/or Password`;
            }
        }

        // Attach both functions to the global window object
        window.signUp = signUp;
        window.signIn = signIn;
    </script>
      

    <script>
        // JavaScript for modal functionality
        const profileButton = document.getElementById('profileButton');
        const modalOverlay = document.getElementById('modalOverlay');

        // Show modal when Profile button is clicked
        profileButton.addEventListener('click', () => {
            modalOverlay.style.display = 'flex'; // Show the modal
        });

        // Close modal when clicking outside the content area
        modalOverlay.addEventListener('click', (event) => {
            if (event.target === modalOverlay) {
                modalOverlay.style.display = 'none'; // Hide the modal
            }
        });

        // Game start button logic
        const startGameBtn = document.getElementById('startGameBtn');
        const playerNameInput = document.getElementById('playerName');
        const startScreen = document.getElementById('startScreen');
        const canvas = document.getElementById('gameCanvas');

        startGameBtn.addEventListener('click', () => {
            const playerName = playerNameInput.value.trim();
            const socket = io();
            if (playerName) {
                startScreen.style.display = 'none';  // Hide the start screen
                canvas.style.display = 'block';      // Show the canvas
                // Emit player's name to start the game
                socket.emit('joinGame', { name: playerName });
            } else {
                alert('Please enter your name!');
            }
        });

        // Resize canvas on window resize
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();  // Initial resize
    </script>
</body>
</html>
